import{a4 as oe,a5 as S,ac as gn,af as ge,ba as Xn,bb as Yn,aE as Qn,bc as Zn,r as E,bd as Ve,T as $,be as Jn,bf as U,o as et,bg as nt,aK as on,bh as tt,bi as lt,ak as T,aj as Z,al as I,bj as rn,an as he,ao as ke,bk as qe,ap as at,bl as ot,as as vn,bm as it,aQ as me,av as _,aw as Ee,M as Le,bn as rt,ax as dt,ay as st,bo as ct,aN as ut,bp as dn,aO as ft,bq as ht,O as Ge,br as sn,aI as z,bs as yn,g as bn,b as gt,aU as vt,e as cn,f as xe,k as Ae,i as ae,c as Fe,j as We,t as un,w as fn,F as yt,l as bt,S as kt,h as mt,bt as xt,bu as pt,bv as wt,x as St,y as Rt,z as Nt}from"./index-38fe6f11.js";import{M as Ct}from"./MemberCard-9d8e2f8c.js";function kn(e){return typeof e=="string"?`s-${e}`:`n-${e}`}const Kt=oe({name:"Switcher",render(){return S("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},S("path",{d:"M12 8l10 8l-10 8z"}))}}),mn=gn("n-tree-select"),pe=gn("n-tree"),_t=oe({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:l}=ge(pe,null);return()=>{const{clsPrefix:s}=e;return S("span",{"data-switcher":!0,class:[`${s}-tree-node-switcher`,e.expanded&&`${s}-tree-node-switcher--expanded`,e.hide&&`${s}-tree-node-switcher--hide`],onClick:e.onClick},S("div",{class:`${s}-tree-node-switcher__icon`},S(Xn,null,{default:()=>{if(e.loading)return S(Yn,{clsPrefix:s,key:"loading",radius:85,strokeWidth:20});const{value:f}=l;return f?f({expanded:e.expanded,selected:e.selected}):S(Qn,{clsPrefix:s,key:"switcher"},{default:()=>S(Kt,null)})}})))}}}),Dt=oe({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const l=ge(pe);function s(u){const{onCheck:i}=e;i&&i(u)}function f(u){e.indeterminate?s(!1):s(u)}return{handleUpdateValue:f,mergedTheme:l.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:l,checked:s,indeterminate:f,disabled:u,focusable:i,handleUpdateValue:m}=this;return S("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},S(Zn,{focusable:i,disabled:u,theme:l.peers.Checkbox,themeOverrides:l.peerOverrides.Checkbox,checked:s,indeterminate:f,onUpdateChecked:m}))}}),Tt=oe({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:l,renderPrefixRef:s,renderSuffixRef:f,labelFieldRef:u}=ge(pe),i=E(null);function m(k){const{onClick:p}=e;p&&p(k)}function w(k){m(k)}return{selfRef:i,renderLabel:l,renderPrefix:s,renderSuffix:f,labelField:u,handleClick:w}},render(){const{clsPrefix:e,labelField:l,nodeProps:s,checked:f=!1,selected:u=!1,renderLabel:i,renderPrefix:m,renderSuffix:w,handleClick:k,onDragstart:p,tmNode:{rawNode:b,rawNode:{prefix:R,suffix:x,[l]:h}}}=this;return S("span",Object.assign({},s,{ref:"selfRef",class:[`${e}-tree-node-content`,s==null?void 0:s.class],onClick:k,draggable:p===void 0?void 0:!0,onDragstart:p}),m||R?S("div",{class:`${e}-tree-node-content__prefix`},m?m({option:b,selected:u,checked:f}):Ve(R)):null,S("div",{class:`${e}-tree-node-content__text`},i?i({option:b,selected:u,checked:f}):Ve(h)),w||x?S("div",{class:`${e}-tree-node-content__suffix`},w?w({option:b,selected:u,checked:f}):Ve(x)):null)}});function hn({position:e,offsetLevel:l,indent:s,el:f}){const u={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")u.left=0,u.top=0,u.bottom=0,u.borderRadius="inherit",u.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const i=e==="before"?"top":"bottom";u[i]=0,u.left=`${f.offsetLeft+6-l*s}px`,u.height="2px",u.backgroundColor="var(--n-drop-mark-color)",u.transformOrigin=i,u.borderRadius="1px",u.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return S("div",{style:u})}function Et({dropPosition:e,node:l}){return l.isLeaf===!1||l.children?!0:e!=="inside"}function Lt(e){return $(()=>e.leafOnly?"child":e.checkStrategy)}function J(e,l){return!!e.rawNode[l]}function xn(e,l,s,f){e==null||e.forEach(u=>{s(u),xn(u[l],l,s,f),f(u)})}function At(e,l,s,f,u){const i=new Set,m=new Set,w=[];return xn(e,f,k=>{if(w.push(k),u(l,k)){m.add(k[s]);for(let p=w.length-2;p>=0;--p)if(!i.has(w[p][s]))i.add(w[p][s]);else return}},()=>{w.pop()}),{expandedKeys:Array.from(i),highlightKeySet:m}}if(Jn&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function Ft(e,l,s,f,u){const i=new Set,m=new Set,w=new Set,k=[],p=[],b=[];function R(h){h.forEach(c=>{if(b.push(c),l(s,c)){i.add(c[f]),w.add(c[f]);for(let g=b.length-2;g>=0;--g){const C=b[g][f];if(!m.has(C))m.add(C),i.has(C)&&i.delete(C);else break}}const y=c[u];y&&R(y),b.pop()})}R(e);function x(h,c){h.forEach(y=>{const g=y[f],C=i.has(g),v=m.has(g);if(!C&&!v)return;const D=y[u];if(D)if(C)c.push(y);else{k.push(g);const F=Object.assign(Object.assign({},y),{[u]:[]});c.push(F),x(D,F[u])}else c.push(y)})}return x(e,p),{filteredTree:p,highlightKeySet:w,expandedKeys:k}}const Pt=oe({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const l=ge(pe),{droppingNodeParentRef:s,droppingMouseNodeRef:f,draggingNodeRef:u,droppingPositionRef:i,droppingOffsetLevelRef:m,nodePropsRef:w,indentRef:k,blockLineRef:p,checkboxPlacementRef:b,checkOnClickRef:R,disabledFieldRef:x}=l,h=U(()=>!!e.tmNode.rawNode.checkboxDisabled),c=U(()=>J(e.tmNode,x.value)),y=U(()=>l.disabledRef.value||c.value),g=$(()=>{const{value:o}=w;if(o)return o({option:e.tmNode.rawNode})}),C=E(null),v={value:null};et(()=>{v.value=C.value.$el});function D(){const{tmNode:o}=e;if(!o.isLeaf&&!o.shallowLoaded){if(!l.loadingKeysRef.value.has(o.key))l.loadingKeysRef.value.add(o.key);else return;const{onLoadRef:{value:N}}=l;N&&N(o.rawNode).then(L=>{L!==!1&&l.handleSwitcherClick(o)}).finally(()=>{l.loadingKeysRef.value.delete(o.key)})}else l.handleSwitcherClick(o)}const F=U(()=>!c.value&&l.selectableRef.value&&(l.internalTreeSelect?l.mergedCheckStrategyRef.value!=="child"||l.multipleRef.value&&l.cascadeRef.value||e.tmNode.isLeaf:!0)),q=U(()=>l.checkableRef.value&&(l.cascadeRef.value||l.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),ee=U(()=>l.displayedCheckedKeysRef.value.includes(e.tmNode.key)),we=U(()=>{const{value:o}=q;if(!o)return!1;const{value:N}=R;return typeof N=="boolean"?N:N(e.tmNode.rawNode)});function ne(o){const{value:N}=l.expandOnClickRef,{value:L}=F,{value:de}=we;if(!L&&!N&&!de||on(o,"checkbox")||on(o,"switcher"))return;const{tmNode:Re}=e;L&&l.handleSelect(Re),N&&!Re.isLeaf&&D(),de&&re(!ee.value)}function Ie(o){var N,L;p.value||(y.value||ne(o),(L=(N=g.value)===null||N===void 0?void 0:N.onClick)===null||L===void 0||L.call(N,o))}function ie(o){var N,L;p.value&&(y.value||ne(o),(L=(N=g.value)===null||N===void 0?void 0:N.onClick)===null||L===void 0||L.call(N,o))}function re(o){l.handleCheck(e.tmNode,o)}function Se(o){l.handleDragStart({event:o,node:e.tmNode})}function Oe(o){o.currentTarget===o.target&&l.handleDragEnter({event:o,node:e.tmNode})}function H(o){o.preventDefault(),l.handleDragOver({event:o,node:e.tmNode})}function W(o){l.handleDragEnd({event:o,node:e.tmNode})}function X(o){o.currentTarget===o.target&&l.handleDragLeave({event:o,node:e.tmNode})}function Be(o){o.preventDefault(),i.value!==null&&l.handleDrop({event:o,node:e.tmNode,dropPosition:i.value})}return{showDropMark:U(()=>{const{value:o}=u;if(!o)return;const{value:N}=i;if(!N)return;const{value:L}=f;if(!L)return;const{tmNode:de}=e;return de.key===L.key}),showDropMarkAsParent:U(()=>{const{value:o}=s;if(!o)return!1;const{tmNode:N}=e,{value:L}=i;return L==="before"||L==="after"?o.key===N.key:!1}),pending:U(()=>l.pendingNodeKeyRef.value===e.tmNode.key),loading:U(()=>l.loadingKeysRef.value.has(e.tmNode.key)),highlight:U(()=>{var o;return(o=l.highlightKeySetRef.value)===null||o===void 0?void 0:o.has(e.tmNode.key)}),checked:ee,indeterminate:U(()=>l.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:U(()=>l.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:U(()=>l.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:y,checkable:q,mergedCheckOnClick:we,checkboxDisabled:h,selectable:F,expandOnClick:l.expandOnClickRef,internalScrollable:l.internalScrollableRef,draggable:l.draggableRef,blockLine:p,nodeProps:g,checkboxFocusable:l.internalCheckboxFocusableRef,droppingPosition:i,droppingOffsetLevel:m,indent:k,checkboxPlacement:b,contentInstRef:C,contentElRef:v,handleCheck:re,handleDrop:Be,handleDragStart:Se,handleDragEnter:Oe,handleDragOver:H,handleDragEnd:W,handleDragLeave:X,handleLineClick:ie,handleContentClick:Ie,handleSwitcherClick:D}},render(){const{tmNode:e,clsPrefix:l,checkable:s,expandOnClick:f,selectable:u,selected:i,checked:m,highlight:w,draggable:k,blockLine:p,indent:b,disabled:R,pending:x,internalScrollable:h,nodeProps:c,checkboxPlacement:y}=this,g=k&&!R?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,C=h?kn(e.key):void 0,v=y==="right",D=s?S(Dt,{right:v,focusable:this.checkboxFocusable,disabled:R||this.checkboxDisabled,clsPrefix:l,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return S("div",Object.assign({class:`${l}-tree-node-wrapper`},g),S("div",Object.assign({},p?c:void 0,{class:[`${l}-tree-node`,{[`${l}-tree-node--selected`]:i,[`${l}-tree-node--checkable`]:s,[`${l}-tree-node--highlight`]:w,[`${l}-tree-node--pending`]:x,[`${l}-tree-node--disabled`]:R,[`${l}-tree-node--selectable`]:u,[`${l}-tree-node--clickable`]:u||f||this.mergedCheckOnClick},c==null?void 0:c.class],"data-key":C,draggable:k&&p,onClick:this.handleLineClick,onDragstart:k&&p&&!R?this.handleDragStart:void 0}),nt(e.level,S("div",{class:`${l}-tree-node-indent`},S("div",{style:{width:`${b}px`}}))),S(_t,{clsPrefix:l,expanded:this.expanded,selected:i,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),v?null:D,S(Tt,{ref:"contentInstRef",clsPrefix:l,checked:m,selected:i,onClick:this.handleContentClick,nodeProps:p?void 0:c,onDragstart:k&&!p&&!R?this.handleDragStart:void 0,tmNode:e}),k?this.showDropMark?hn({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:b}):this.showDropMarkAsParent?hn({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:b}):null:null,v?D:null))}}),pn=Pt;function It({props:e,fNodesRef:l,mergedExpandedKeysRef:s,mergedSelectedKeysRef:f,handleSelect:u,handleSwitcherClick:i}){const{value:m}=f,w=ge(mn,null),k=w?w.pendingNodeKeyRef:E(m.length?m[m.length-1]:null);function p(b){if(!e.keyboard)return;const{value:R}=k;if(R===null){if((b.key==="ArrowDown"||b.key==="ArrowUp")&&b.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(b.key)&&R===null){const{value:x}=l;let h=0;for(;h<x.length;){if(!x[h].disabled){k.value=x[h].key;break}h+=1}}}else{const{value:x}=l;let h=x.findIndex(c=>c.key===R);if(!~h)return;if(b.key==="Enter")u(x[h]);else if(b.key==="ArrowDown")for(b.preventDefault(),h+=1;h<x.length;){if(!x[h].disabled){k.value=x[h].key;break}h+=1}else if(b.key==="ArrowUp")for(b.preventDefault(),h-=1;h>=0;){if(!x[h].disabled){k.value=x[h].key;break}h-=1}else if(b.key==="ArrowLeft"){const c=x[h];if(c.isLeaf||!s.value.includes(R)){const y=c.getParent();y&&(k.value=y.key)}else i(c)}else if(b.key==="ArrowRight"){const c=x[h];if(c.isLeaf)return;if(!s.value.includes(R))i(c);else for(h+=1;h<x.length;){if(!x[h].disabled){k.value=x[h].key;break}h+=1}}}}return{pendingNodeKeyRef:k,handleKeydown:p}}const Ot=oe({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return S(lt,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>S("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:tt(this.height)}},this.nodes.map(l=>S(pn,{clsPrefix:e,tmNode:l})))})}}),Bt=T("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[Z("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),Z(">",[T("tree-node",[Z("&:first-child",{marginTop:0})])]),T("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 height: 0;
 `),T("tree-motion-wrapper",[I("expand",[rn({duration:"0.2s"})]),I("collapse",[rn({duration:"0.2s",reverse:!0})])]),T("tree-node-wrapper",`
 box-sizing: border-box;
 padding: 3px 0;
 `),T("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[I("highlight",[T("tree-node-content",[he("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),I("disabled",[T("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),ke("disabled",[I("clickable",[T("tree-node-content",`
 cursor: pointer;
 `)])])]),I("block-node",[T("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),ke("block-line",[T("tree-node",[ke("disabled",[T("tree-node-content",[Z("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),I("selectable",[T("tree-node-content",[Z("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),I("pending",[T("tree-node-content",`
 background-color: var(--n-node-color-hover);
 `)]),I("selected",[T("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),I("block-line",[T("tree-node",[ke("disabled",[Z("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),I("pending",`
 background-color: var(--n-node-color-hover);
 `),I("selectable",[ke("selected",[Z("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),I("selected",{backgroundColor:"var(--n-node-color-active)"})]),I("disabled",`
 cursor: not-allowed;
 `)])]),T("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: 24px;
 width: 24px;
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[he("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[T("icon",[qe()]),T("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[qe()]),T("base-icon",[qe()])]),I("hide",{visibility:"hidden"}),I("expanded",{transform:"rotate(90deg)"})]),T("tree-node-checkbox",`
 display: inline-flex;
 height: 24px;
 width: 16px;
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 margin-right: 4px;
 `,[I("right","margin-left: 4px;")]),I("checkable",[T("tree-node-content",`
 padding: 0 6px;
 `)]),T("tree-node-content",`
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: 24px;
 box-sizing: border-box;
 line-height: 1.5;
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 text-decoration-color: #0000;
 text-decoration-line: underline;
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[Z("&:last-child",{marginBottom:0}),he("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),he("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),he("suffix",`
 display: inline-flex;
 `)]),he("empty","margin: auto;")]);var $t=globalThis&&globalThis.__awaiter||function(e,l,s,f){function u(i){return i instanceof s?i:new s(function(m){m(i)})}return new(s||(s=Promise))(function(i,m){function w(b){try{p(f.next(b))}catch(R){m(R)}}function k(b){try{p(f.throw(b))}catch(R){m(R)}}function p(b){b.done?i(b.value):u(b.value).then(w,k)}p((f=f.apply(e,l||[])).next())})};const Pe=30;function Ut(e,l,s,f){return{getIsGroup(){return!1},getKey(i){return i[e]},getChildren:f||(i=>i[l]),getDisabled(i){return!!(i[s]||i.checkboxDisabled)}}}const Mt={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},zt=Object.assign(Object.assign(Object.assign(Object.assign({},vn.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:Et},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),Mt),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),jt=oe({name:"Tree",props:zt,setup(e){const{mergedClsPrefixRef:l,inlineThemeDisabled:s,mergedRtlRef:f}=at(e),u=ot("Tree",f,l),i=vn("Tree","-tree",Bt,ht,e,l),m=E(null),w=E(null),k=E(null);function p(){var n;return(n=k.value)===null||n===void 0?void 0:n.listElRef}function b(){var n;return(n=k.value)===null||n===void 0?void 0:n.itemsElRef}const R=$(()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(a,r)=>{if(!a.length)return!0;const d=r[t];return typeof d=="string"?d.toLowerCase().includes(a.toLowerCase()):!1}}),x=$(()=>{const{pattern:n}=e;return n?!n.length||!R.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:Ft(e.data,R.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),h=$(()=>it(e.showIrrelevantNodes?e.data:x.value.filteredTree,Ut(e.keyField,e.childrenField,e.disabledField,e.getChildren))),c=ge(mn,null),y=e.internalTreeSelect?c.dataTreeMate:h,{watchProps:g}=e,C=E([]);g!=null&&g.includes("defaultCheckedKeys")?me(()=>{C.value=e.defaultCheckedKeys}):C.value=e.defaultCheckedKeys;const v=_(e,"checkedKeys"),D=Ee(v,C),F=$(()=>y.value.getCheckedKeys(D.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),q=Lt(e),ee=$(()=>F.value.checkedKeys),we=$(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:F.value.indeterminateKeys}),ne=E([]);g!=null&&g.includes("defaultSelectedKeys")?me(()=>{ne.value=e.defaultSelectedKeys}):ne.value=e.defaultSelectedKeys;const Ie=_(e,"selectedKeys"),ie=Ee(Ie,ne),re=E([]),Se=n=>{re.value=e.defaultExpandAll?y.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};g!=null&&g.includes("defaultExpandedKeys")?me(()=>{Se(void 0)}):me(()=>{Se(e.defaultExpandedKeys)});const Oe=_(e,"expandedKeys"),H=Ee(Oe,re),W=$(()=>h.value.getFlattenedNodes(H.value)),{pendingNodeKeyRef:X,handleKeydown:Be}=It({props:e,mergedSelectedKeysRef:ie,fNodesRef:W,mergedExpandedKeysRef:H,handleSelect:ze,handleSwitcherClick:Je});let o=null,N=null;const L=E(new Set),de=$(()=>e.internalHighlightKeySet||x.value.highlightKeySet),Re=Ee(de,L),Ne=E(new Set),wn=$(()=>H.value.filter(n=>!Ne.value.has(n)));let Xe=0;const ve=E(null),Ce=E(null),Ke=E(null),_e=E(null),De=E(0),Sn=$(()=>{const{value:n}=Ce;return n?n.parent:null});Le(_(e,"data"),()=>{Ne.value.clear(),X.value=null,be()},{deep:!1});let $e=!1;const Ue=()=>{$e=!0,Ge(()=>{$e=!1})};let ye;Le(_(e,"pattern"),(n,t)=>{if(e.showIrrelevantNodes)if(ye=void 0,n){const{expandedKeys:a,highlightKeySet:r}=At(e.data,e.pattern,e.keyField,e.childrenField,R.value);L.value=r,Ue(),ce(a,j(a),{node:null,action:"filter"})}else L.value=new Set;else if(!n.length)ye!==void 0&&(Ue(),ce(ye,j(ye),{node:null,action:"filter"}));else{t.length||(ye=H.value);const{expandedKeys:a}=x.value;a!==void 0&&(Ue(),ce(a,j(a),{node:null,action:"filter"}))}});function Ye(n){return $t(this,void 0,void 0,function*(){const{onLoad:t}=e;if(!t){yield Promise.resolve();return}const{value:a}=Ne;if(!a.has(n.key)){a.add(n.key);try{(yield t(n.rawNode))===!1&&ue()}catch(r){console.error(r),ue()}a.delete(n.key)}})}me(()=>{var n;const{value:t}=h;if(!t)return;const{getNode:a}=t;(n=H.value)===null||n===void 0||n.forEach(r=>{const d=a(r);d&&!d.shallowLoaded&&Ye(d)})});const se=E(!1),Y=E([]);Le(wn,(n,t)=>{if(!e.animated||$e){Ge(Te);return}const a=new Set(t);let r=null,d=null;for(const A of n)if(!a.has(A)){if(r!==null)return;r=A}const O=new Set(n);for(const A of t)if(!O.has(A)){if(d!==null)return;d=A}if(r===null&&d===null)return;const{virtualScroll:P}=e,G=(P?k.value.listElRef:m.value).offsetHeight,le=Math.ceil(G/Pe)+1;let V;if(r!==null&&(V=t),d!==null&&(V===void 0?V=n:V=V.filter(A=>A!==d)),se.value=!0,Y.value=h.value.getFlattenedNodes(V),r!==null){const A=Y.value.findIndex(B=>B.key===r);if(~A){const B=Y.value[A].children;if(B){const Q=sn(B,n);Y.value.splice(A+1,0,{__motion:!0,mode:"expand",height:P?Q.length*Pe:void 0,nodes:P?Q.slice(0,le):Q})}}}if(d!==null){const A=Y.value.findIndex(B=>B.key===d);if(~A){const B=Y.value[A].children;if(!B)return;se.value=!0;const Q=sn(B,n);Y.value.splice(A+1,0,{__motion:!0,mode:"collapse",height:P?Q.length*Pe:void 0,nodes:P?Q.slice(0,le):Q})}}});const Rn=$(()=>rt(W.value)),Nn=$(()=>se.value?Y.value:W.value);function Te(){const{value:n}=w;n&&n.sync()}function Cn(){se.value=!1,e.virtualScroll&&Ge(Te)}function j(n){const{getNode:t}=y.value;return n.map(a=>{var r;return((r=t(a))===null||r===void 0?void 0:r.rawNode)||null})}function ce(n,t,a){const{"onUpdate:expandedKeys":r,onUpdateExpandedKeys:d}=e;re.value=n,r&&z(r,n,t,a),d&&z(d,n,t,a)}function Qe(n,t,a){const{"onUpdate:checkedKeys":r,onUpdateCheckedKeys:d}=e;C.value=n,d&&z(d,n,t,a),r&&z(r,n,t,a)}function Kn(n,t){const{"onUpdate:indeterminateKeys":a,onUpdateIndeterminateKeys:r}=e;a&&z(a,n,t),r&&z(r,n,t)}function Me(n,t,a){const{"onUpdate:selectedKeys":r,onUpdateSelectedKeys:d}=e;ne.value=n,d&&z(d,n,t,a),r&&z(r,n,t,a)}function _n(n){const{onDragenter:t}=e;t&&z(t,n)}function Dn(n){const{onDragleave:t}=e;t&&z(t,n)}function Tn(n){const{onDragend:t}=e;t&&z(t,n)}function En(n){const{onDragstart:t}=e;t&&z(t,n)}function Ln(n){const{onDragover:t}=e;t&&z(t,n)}function An(n){const{onDrop:t}=e;t&&z(t,n)}function be(){Fn(),te()}function Fn(){ve.value=null}function te(){De.value=0,Ce.value=null,Ke.value=null,_e.value=null,ue()}function ue(){o&&(window.clearTimeout(o),o=null),N=null}function Ze(n,t){if(e.disabled||J(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple){ze(n);return}const a=t?"check":"uncheck",{checkedKeys:r,indeterminateKeys:d}=y.value[a](n.key,ee.value,{cascade:e.cascade,checkStrategy:q.value,allowNotLoaded:e.allowCheckingNotLoaded});Qe(r,j(r),{node:n.rawNode,action:a}),Kn(d,j(d))}function Pn(n){if(e.disabled)return;const{key:t}=n,{value:a}=H,r=a.findIndex(d=>d===t);if(~r){const d=Array.from(a);d.splice(r,1),ce(d,j(d),{node:n.rawNode,action:"collapse"})}else{const d=h.value.getNode(t);if(!d||d.isLeaf)return;let O;if(e.accordion){const P=new Set(n.siblings.map(({key:G})=>G));O=a.filter(G=>!P.has(G)),O.push(t)}else O=a.concat(t);ce(O,j(O),{node:n.rawNode,action:"expand"})}}function Je(n){e.disabled||se.value||Pn(n)}function ze(n){if(!(e.disabled||!e.selectable)){if(X.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:a}}=F;e.multiple?Ze(n,!(t.includes(n.key)||a.includes(n.key))):Qe([n.key],j([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(ie.value),a=t.findIndex(r=>r===n.key);~a?e.cancelable&&t.splice(a,1):~a||t.push(n.key),Me(t,j(t),{node:n.rawNode,action:~a?"unselect":"select"})}else ie.value.includes(n.key)?e.cancelable&&Me([],[],{node:n.rawNode,action:"unselect"}):Me([n.key],j([n.key]),{node:n.rawNode,action:"select"})}}function In(n){if(o&&(window.clearTimeout(o),o=null),n.isLeaf)return;N=n.key;const t=()=>{if(N!==n.key)return;const{value:a}=Ke;if(a&&a.key===n.key&&!H.value.includes(n.key)){const r=H.value.concat(n.key);ce(r,j(r),{node:n.rawNode,action:"expand"})}o=null,N=null};n.shallowLoaded?o=window.setTimeout(()=>{t()},1e3):o=window.setTimeout(()=>{Ye(n).then(()=>{t()})},1e3)}function On({event:n,node:t}){!e.draggable||e.disabled||J(t,e.disabledField)||(en({event:n,node:t},!1),_n({event:n,node:t.rawNode}))}function Bn({event:n,node:t}){!e.draggable||e.disabled||J(t,e.disabledField)||Dn({event:n,node:t.rawNode})}function $n(n){n.target===n.currentTarget&&te()}function Un({event:n,node:t}){be(),!(!e.draggable||e.disabled||J(t,e.disabledField))&&Tn({event:n,node:t.rawNode})}function Mn({event:n,node:t}){!e.draggable||e.disabled||J(t,e.disabledField)||(Xe=n.clientX,ve.value=t,En({event:n,node:t.rawNode}))}function en({event:n,node:t},a=!0){var r;if(!e.draggable||e.disabled||J(t,e.disabledField))return;const{value:d}=ve;if(!d)return;const{allowDrop:O,indent:P}=e;a&&Ln({event:n,node:t.rawNode});const G=n.currentTarget,{height:le,top:V}=G.getBoundingClientRect(),A=n.clientY-V;let B;O({node:t.rawNode,dropPosition:"inside",phase:"drag"})?A<=8?B="before":A>=le-8?B="after":B="inside":A<=le/2?B="before":B="after";const{value:Wn}=Rn;let K,M;const je=Wn(t.key);if(je===null){te();return}let tn=!1;B==="inside"?(K=t,M="inside"):B==="before"?t.isFirstChild?(K=t,M="before"):(K=W.value[je-1],M="after"):(K=t,M="after"),!K.isLeaf&&H.value.includes(K.key)&&(tn=!0,M==="after"&&(K=W.value[je+1],K?M="before":(K=t,M="inside")));const ln=K;if(Ke.value=ln,!tn&&d.isLastChild&&d.key===K.key&&(M="after"),M==="after"){let an=Xe-n.clientX,He=0;for(;an>=P/2&&K.parent!==null&&K.isLastChild&&He<1;)an-=P,He+=1,K=K.parent;De.value=He}else De.value=0;if((d.contains(K)||M==="inside"&&((r=d.parent)===null||r===void 0?void 0:r.key)===K.key)&&!(d.key===ln.key&&d.key===K.key)){te();return}if(!O({node:K.rawNode,dropPosition:M,phase:"drag"})){te();return}if(d.key===K.key)ue();else if(N!==K.key)if(M==="inside"){if(e.expandOnDragenter){if(In(K),!K.shallowLoaded&&N!==K.key){be();return}}else if(!K.shallowLoaded){be();return}}else ue();else M!=="inside"&&ue();_e.value=M,Ce.value=K}function zn({event:n,node:t,dropPosition:a}){if(!e.draggable||e.disabled||J(t,e.disabledField))return;const{value:r}=ve,{value:d}=Ce,{value:O}=_e;if(!(!r||!d||!O)&&e.allowDrop({node:d.rawNode,dropPosition:O,phase:"drag"})&&r.key!==d.key){if(O==="before"){const P=r.getNext({includeDisabled:!0});if(P&&P.key===d.key){te();return}}if(O==="after"){const P=r.getPrev({includeDisabled:!0});if(P&&P.key===d.key){te();return}}An({event:n,node:d.rawNode,dragNode:r.rawNode,dropPosition:a}),be()}}function jn(){Te()}function Hn(){Te()}function Vn(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:a}=w;if(!((t=a==null?void 0:a.containerRef)===null||t===void 0)&&t.contains(n.relatedTarget))return;X.value=null}else{const{value:a}=m;if(a!=null&&a.contains(n.relatedTarget))return;X.value=null}}Le(X,n=>{var t,a;if(n!==null){if(e.virtualScroll)(t=k.value)===null||t===void 0||t.scrollTo({key:n});else if(e.internalScrollable){const{value:r}=w;if(r===null)return;const d=(a=r.contentRef)===null||a===void 0?void 0:a.querySelector(`[data-key="${kn(n)}"]`);if(!d)return;r.scrollTo({el:d})}}}),dt(pe,{loadingKeysRef:Ne,highlightKeySetRef:Re,displayedCheckedKeysRef:ee,displayedIndeterminateKeysRef:we,mergedSelectedKeysRef:ie,mergedExpandedKeysRef:H,mergedThemeRef:i,mergedCheckStrategyRef:q,nodePropsRef:_(e,"nodeProps"),disabledRef:_(e,"disabled"),checkableRef:_(e,"checkable"),selectableRef:_(e,"selectable"),expandOnClickRef:_(e,"expandOnClick"),onLoadRef:_(e,"onLoad"),draggableRef:_(e,"draggable"),blockLineRef:_(e,"blockLine"),indentRef:_(e,"indent"),cascadeRef:_(e,"cascade"),checkOnClickRef:_(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Ke,droppingNodeParentRef:Sn,draggingNodeRef:ve,droppingPositionRef:_e,droppingOffsetLevelRef:De,fNodesRef:W,pendingNodeKeyRef:X,disabledFieldRef:_(e,"disabledField"),internalScrollableRef:_(e,"internalScrollable"),internalCheckboxFocusableRef:_(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:_(e,"renderLabel"),renderPrefixRef:_(e,"renderPrefix"),renderSuffixRef:_(e,"renderSuffix"),renderSwitcherIconRef:_(e,"renderSwitcherIcon"),labelFieldRef:_(e,"labelField"),multipleRef:_(e,"multiple"),handleSwitcherClick:Je,handleDragEnd:Un,handleDragEnter:On,handleDragLeave:Bn,handleDragStart:Mn,handleDrop:zn,handleDragOver:en,handleSelect:ze,handleCheck:Ze});function qn(n){var t;(t=k.value)===null||t===void 0||t.scrollTo(n)}const Gn={handleKeydown:Be,scrollTo:qn,getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=F.value;return{keys:n,options:j(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=F.value;return{keys:n,options:j(n)}}},nn=$(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:t,nodeBorderRadius:a,nodeColorHover:r,nodeColorPressed:d,nodeColorActive:O,arrowColor:P,loadingColor:G,nodeTextColor:le,nodeTextColorDisabled:V,dropMarkColor:A}}=i.value;return{"--n-arrow-color":P,"--n-loading-color":G,"--n-bezier":n,"--n-font-size":t,"--n-node-border-radius":a,"--n-node-color-active":O,"--n-node-color-hover":r,"--n-node-color-pressed":d,"--n-node-text-color":le,"--n-node-text-color-disabled":V,"--n-drop-mark-color":A}}),fe=s?st("tree",void 0,nn,e):void 0;return Object.assign(Object.assign({},Gn),{mergedClsPrefix:l,mergedTheme:i,rtlEnabled:u,fNodes:Nn,aip:se,selfElRef:m,virtualListInstRef:k,scrollbarInstRef:w,handleFocusout:Vn,handleDragLeaveTree:$n,handleScroll:jn,getScrollContainer:p,getScrollContent:b,handleAfterEnter:Cn,handleResize:Hn,cssVars:s?void 0:nn,themeClass:fe==null?void 0:fe.themeClass,onRender:fe==null?void 0:fe.onRender})},render(){var e;const{fNodes:l,internalRenderEmpty:s}=this;if(!l.length&&s)return s();const{mergedClsPrefix:f,blockNode:u,blockLine:i,draggable:m,disabled:w,internalFocusable:k,checkable:p,handleKeydown:b,rtlEnabled:R,handleFocusout:x}=this,h=k&&!w,c=h?"0":void 0,y=[`${f}-tree`,R&&`${f}-tree--rtl`,p&&`${f}-tree--checkable`,(i||u)&&`${f}-tree--block-node`,i&&`${f}-tree--block-line`],g=v=>"__motion"in v?S(Ot,{height:v.height,nodes:v.nodes,clsPrefix:f,mode:v.mode,onAfterEnter:this.handleAfterEnter}):S(pn,{key:v.key,tmNode:v,clsPrefix:f});if(this.virtualScroll){const{mergedTheme:v,internalScrollablePadding:D}=this,F=ct(D||"0");return S(dn,{ref:"scrollbarInstRef",onDragleave:m?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:y,theme:v.peers.Scrollbar,themeOverrides:v.peerOverrides.Scrollbar,tabindex:c,onKeydown:h?b:void 0,onFocusout:h?x:void 0},{default:()=>{var q;return(q=this.onRender)===null||q===void 0||q.call(this),S(ut,{ref:"virtualListInstRef",items:this.fNodes,itemSize:Pe,ignoreItemResize:this.aip,paddingTop:F.top,paddingBottom:F.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:F.left,paddingRight:F.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:ee})=>g(ee)})}})}const{internalScrollable:C}=this;return y.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),C?S(dn,{class:y,tabindex:c,onKeydown:h?b:void 0,onFocusout:h?x:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>S("div",{onDragleave:m?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(g))}):S("div",{class:y,tabindex:c,ref:"selfElRef",style:this.cssVars,onKeydown:h?b:void 0,onFocusout:h?x:void 0,onDragleave:m?this.handleDragLeaveTree:void 0},l.length?l.map(g):ft(this.$slots.empty,()=>[S(yn,{class:`${f}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}}),Ht=()=>bn("/api/v1/organize/department/all"),Vt=()=>bn("/api/v1/organize/personnel/all");const qt=e=>(St("data-v-5fd85b38"),e=e(),Rt(),e),Gt={class:"el-container height100 o-hidden"},Wt={class:"el-aside bdr-r aside"},Xt={class:"el-main"},Yt={class:"el-container is-vertical height100"},Qt={class:"el-header from-header bdr-b"},Zt={style:{"font-weight":"500"}},Jt={key:0,class:"el-main me-scrollbar pd-10"},el={class:"cards"},nl={key:1,class:"el-main flex-center"},tl=qt(()=>ae("img",{src:Nt,alt:""},null,-1)),ll={__name:"organize",setup(e){const l=vt(),s=E(-1),f=E(""),u=E([]),i=$(()=>u.value.filter(c=>c.nickname.match(f.value)!=null&&(s.value==-1||c.dept_items.some(y=>y.dept_id==s.value)))),m=E([]),w=E("全体成员"),k=c=>{l.uid!=c.user_id?xt(1,c.user_id):window.$message.info("禁止给自己发送消息!!")};function p(c){const y={};c.forEach(v=>y[v.dept_id]=v);const g=v=>{let D=[];return v.split(",").forEach(F=>{y[parseInt(F)]&&D.push(y[parseInt(F)].dept_name)}),D},C=[];return c.forEach(v=>{const D=y[v.parent_id];v.breadcrumb=g(v.ancestors||"").join(" / "),D?(D.children==null&&(D.children=[]),D.children.push(v)):C.push(v)}),C}const b=c=>{pt(wt,{uid:c.user_id})},R=({option:c})=>({onClick(){w.value=c.breadcrumb||"全部成员",s.value=c.dept_id}});function x(){Ht().then(c=>{const y=c.data.items||[];y.unshift({dept_id:-1,dept_name:"全部成员",parent_id:0,ancestors:"0"});for(const g of y)g.suffix=0,g.dept_id>0&&(g.ancestors=`${g.ancestors},${g.dept_id}`);m.value=p(y)})}async function h(){const c=await Vt();if(!c||c.code!=200)return;let y=c.data.items||[];y.map(g=>{g.online=!1,g.sort=1e6,g.position_items.sort((v,D)=>v.sort-D.sort);let C=[];for(const v of g.position_items)C.push(v.name),v.sort<g.sort&&(g.sort=v.sort);return g.position=C.join("、"),g}),u.value=y.sort((g,C)=>g.sort-C.sort)}return h(),x(),(c,y)=>{const g=cn("n-icon"),C=cn("n-input");return xe(),Ae("section",Gt,[ae("aside",Wt,[Fe(We(jt),{"key-field":"dept_id","label-field":"dept_name","block-line":"",data:m.value,"default-expand-all":!0,cancelable:!0,"default-selected-keys":[-1],"node-props":R},null,8,["data"])]),ae("main",Xt,[ae("section",Yt,[ae("header",Qt,[ae("div",Zt,un(w.value)+" ("+un(i.value.length)+") ",1),Fe(C,{value:f.value,"onUpdate:value":y[0]||(y[0]=v=>f.value=v),valueModifiers:{trim:!0},placeholder:"搜索",clearable:"",style:{width:"200px"},round:""},{prefix:fn(()=>[Fe(g,{component:We(kt)},null,8,["component"])]),_:1},8,["value"])]),i.value.length?(xe(),Ae("main",Jt,[ae("div",el,[(xe(!0),Ae(yt,null,bt(i.value,v=>(xe(),mt(Ct,{username:v.nickname,gender:v.gender,motto:v.position,flag:"状态/离线",onClick:D=>b(v),onToTalk:D=>k(v)},null,8,["username","gender","motto","onClick","onToTalk"]))),256))])])):(xe(),Ae("main",nl,[Fe(We(yn),{size:"200",description:"暂无相关数据"},{icon:fn(()=>[tl]),_:1})]))])])])}}},il=gt(ll,[["__scopeId","data-v-5fd85b38"]]);export{il as default};
