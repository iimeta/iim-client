import{b as x,a2 as C,r as h,d as $,bD as E,e as K,f as I,k as N,i as p,c as o,w as n,j as t,aX as f,aD as g,H as w,C as c,q as D,v as F,t as q,a$ as R,x as T,y as U}from"./index-9dbb5049.js";import{b as V}from"./auth-4b772f14.js";import{S as B,c as b,b as z}from"./common-f665e601.js";const P=l=>(T("data-v-ec8a0b79"),l=l(),U(),l),j={class:"el-container is-vertical login-box forget"},G=P(()=>p("header",{class:"el-header box-header"},"找回密码",-1)),H={class:"el-main",style:{padding:"3px"}},L={class:"helper"},M={__name:"forget",setup(l){const m=C(),_=h(),y={code:{required:!0,trigger:["blur","input"],message:"验证码不能为空"},username:{required:!0,trigger:["blur","input"],validator(a,e){if(e){if(!b(e))return new Error("请正确填写邮箱")}else return new Error("邮箱不能为空");return!0}},password:{required:!0,trigger:["blur","input"],message:"密码不能为空"}},d=h(0),v=new B("FORGET_PSW_SMS",60,a=>d.value=a),s=$({username:"",password:"",code:"",loading:!1}),S=()=>{s.loading=!0;const a=V({account:s.username,password:s.password,code:s.code});a.then(e=>{e.code==200?(window.$message.success("密码找回成功"),setTimeout(()=>{m.push("/auth/login")},500)):window.$message.warning(e.message)}),a.finally(()=>{s.loading=!1})},i=a=>{a.preventDefault(),_.value.validate(e=>{!e&&S()})},k=()=>{if(!b(s.username)){window.$message.warning("请正确填写邮箱");return}const a=z({email:s.username,channel:"forget_account"});a.then(e=>{e.code==200?(v.start(),window.$message.success("验证码发送成功")):window.$message.warning(e.message)}),a.finally(()=>{s.loading=!1})};return E(()=>{v.clear()}),(a,e)=>{const u=K("n-button");return I(),N("section",j,[G,p("main",H,[o(t(R),{ref_key:"formRef",ref:_,size:"large",model:s,rules:y},{default:n(()=>[o(t(f),{path:"username","show-label":!1},{default:n(()=>[o(t(g),{placeholder:"邮箱",value:s.username,"onUpdate:value":e[0]||(e[0]=r=>s.username=r),onKeydown:w(i,["enter","native"])},null,8,["value","onKeydown"])]),_:1}),o(t(f),{path:"code","show-label":!1},{default:n(()=>[o(t(g),{placeholder:"验证码",maxlength:6,value:s.code,"onUpdate:value":e[1]||(e[1]=r=>s.code=r),onKeydown:w(i,["enter","native"])},null,8,["value","onKeydown"]),o(u,{tertiary:"",class:"mt-l5",onClick:k,disabled:d.value>0},{default:n(()=>[c(" 获取验证码 "),D(p("span",null,"("+q(d.value)+"s)",513),[[F,d.value>0]])]),_:1},8,["disabled"])]),_:1}),o(t(f),{path:"password","show-label":!1},{default:n(()=>[o(t(g),{placeholder:"设置密码",type:"password","show-password-on":"click",value:s.password,"onUpdate:value":e[2]||(e[2]=r=>s.password=r),onKeydown:w(i,["enter","native"])},null,8,["value","onKeydown"])]),_:1}),o(u,{type:"primary",size:"large",block:"",class:"mt-t20",onClick:i,loading:s.loading},{default:n(()=>[c(" 立即找回 ")]),_:1},8,["loading"])]),_:1},8,["model"]),p("div",L,[o(u,{text:"",color:"#409eff",onClick:e[3]||(e[3]=r=>t(m).push("/auth/register"))},{default:n(()=>[c(" 注册账号 ")]),_:1}),o(u,{text:"",color:"#409eff",onClick:e[4]||(e[4]=r=>t(m).push("/auth/login"))},{default:n(()=>[c(" 已有账号，立即登录? ")]),_:1})])])])}}},A=x(M,[["__scopeId","data-v-ec8a0b79"]]);export{A as default};
